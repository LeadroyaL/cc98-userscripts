<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>demo</title>
  <style type="text/css">
  body { font: 12px/1.4 sans-serif; }

  #replydialog {
    font: 12px/1.4 ubuntu, "Lucida Grande", "Hiragino Sans GB W3", "Microsoft Yahei", sans-serif;
    width: 650px;
    position: relative;
    border: 5px solid #ccc;
    padding: 10px;
    margin: 0 auto;
  }

  #replydialog ul{
    display: block;
    list-style: none;
    padding-left: 0;
    margin: 0;
  }

  .clearfix { clear: both; }

  .box_title {
    cursor: move;
    font-size: 16px;
    line-height: 20px;
    margin: 0 0 20px 0;
    color: #0060A6;
    text-align: left;
  }
  .close_btn {
    cursor: pointer;
    width: 20px;
    height: 20px;
    background: url("http://file.cc98.org/uploadfile/2013/8/7/1954562236.gif");
    float: right;
  }
  .close_btn:hover { background-position: 0 -20px; }

  #replydialog #subject_line{
    height: 20px;
    margin: 10px 0;
  }
  #post_expression {
    height: 15px;
    width: 15px;
    vertical-align: middle;
  }
  #post_subject {
    margin-left: 5px;
    width: 400px;
    border: 1px solid #e0e0e0;
  }
  #post_subject:focus { outline: 1px solid #4A8CF7; }

  #editor {
    margin: 0 auto;
    border: 1px solid #9AC0E6;
    overflow: auto;
  }

  #e_control {
    color: grey;

    background-color: #F1F4F8;
    border-bottom: 1px solid #9AC0E6;
    padding: 3px 3px 5px 3px;
  }
  img.e_ctrl_btn {
    height: 16px;
    width: 16px;
    margin: 0 3px 0 0;
    border: 0;
    vertical-align: middle;
  }
  #add_attachments {
    color: grey;
    text-decoration: none;
  }

  #replycontent {
    border: 0;
    height: 200px;
    width: 100%;
    padding: 5px;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;

    font: inherit;
    overflow: auto;
    resize: vertical;
    word-wrap: break-word;
  }
  #replycontent:focus { outline: 0px solid #9AC0E6; }

  #e_statusbar {
    background-color: #f2f2f2;
    border-top: 1px solid #9AC0E6;

    color: grey;
    padding: 2px;
    text-align: right;
  }
  #e_save, #e_recover {
    text-decoration: none;
    color: grey;
  }
  #e_tip {
    width: 200px;
    float: left;
    text-align: left;
  }


  /* 一个对话框中的（末行）按钮区 */
  .btn_bar {
    margin: 10px 0 0 0;
    width: 100%;
  }
  /* 标准按钮样式 */
  .soda_button {
    height: 20px;
    width: 75px;
    border: 0;

    cursor: pointer;
    font: inherit;
    color: #fff;
    background-color: #6595D6;
    padding: 0 0 1px; /* 用baseliner测试了一下，这样内部文字是居中的，不过我也不清楚为什么是这个数 */
  }
  #submitting_status {
    padding-left: 20px;
    vertical-align: middle;
    text-align: left;
    color: red;
  }


  #attach_table {
    position:relative;
    height:50px;
    width: 100%;
    margin-top: 10px;

    padding: 2px;
    border-collapse: collapse;
    overflow: visible;
    text-align: left;
  }
  #attach_table th, #attach_table td { border: 1px solid #fff;}
  #attach_table > thead {
    color: #fff;
    background-color: #6595D6;
  }
  #attach_list > *:nth-child(even) { background-color:#ddd; }
  #attach_list > *:nth-child(odd) { background-color:#eee; }

  .filename { color: #090; }
  .uploadfail { color:#900; }
  .uploadsuccess { color:#090; }

  #upload_panel {
    position: fixed;

    border: 5px solid #ccc;
    margin: 0 auto;
    padding: 8px;

    background-color: #fff;
    opacity: 0.8;
    z-index: 200;
  }
  /* 垂直居中显示checkbox */
  #image_autoshow {
    margin: 0 2px 2px 0;
    padding: 0;
    vertical-align: middle;
  }
  /* 上传面板的留白要比回复面板的留白稍小，故margin要覆盖定义 */
  #upload_title { margin: 0 0 15px 0; }
  /* 这个只是用来保证各浏览器的上传按钮宽度一样 */
  #files { width: 250px; }
  </style>
</head>
<body>
<div id="replydialog">
<form id="replyform">
<ul id="replytable"width="100%">
  <li id="dialog_header">
    <h3 id="replybox_title" class="box_title">
      参与/回复主题
      <span><a id="dialog_close_btn" class="close_btn" title="关闭"></a></span>
    </h3>
  </li>

  <li id="subject_line" class="clearfix">
    <label for="post_subject"><a id="post_expression" href="javascript:void(0);"><img src="http://www.cc98.org/face/face7.gif"></a></label>
    <input type="text" id="post_subject" name="post_subject">
  </li>

  <li>
    <div id="editor">
      <div id="e_control">
        <a id="bold" title="加粗" href="javascript:void(0);"><img class="e_ctrl_btn" src="http://file.cc98.org/uploadfile/2013/8/7/22333264497.gif"></a>
        <a id="strikethrough" title="删除线" href="javascript:void(0);"><img class="e_ctrl_btn" src="http://file.cc98.org/uploadfile/2013/8/7/22525420119.png"></a>
        <a id="add_emotions" title="表情" href="javascript:void(0);"><img class="e_ctrl_btn" src="http://www.cc98.org/emot/simpleemot/emot88.gif"></a>
        |
        <a id="add_attachments" href="javascript:void(0);">添加附件</a>
      </div>

      <textarea id="replycontent" role="textbox" aria-multiline="true"></textarea>
      
      <div id="e_statusbar">
        <span id="e_tip">数据已于 01:47 保存</span>
        <span id="e_autosavecount">10 秒后保存</span>
        <a id="e_save" href="javascript:void(0);">保存数据</a>
        |
        <a id="e_recover" href="javascript:void(0);">恢复数据</a>
      </div>
    </div>
  </li>

  <li>
    <table class="btn_bar">
      <tbody>
        <tr>
          <td><input type="button" id="submit_post" name="submit_post" class="soda_button" value="提交回复"></td>
          <td><span id="submitting_status">论坛限制发帖时间间隔10s，倒计时9s…</span></td>
        </tr>
      </tbody>
    </table>
  </li>

</ul>
</form>
<!--
<table id="attach_table">
  <thead>
    <tr>
      <th width="50%">文件名</th>
      <th width="20%">大小</th>
      <th width="30%">状态</th>
    </tr>
  </thead>
  <tbody id="attach_list">
    <tr>
      <td class="filename">周杰倫 - 尋找周杰倫.png</td>
      <td>746.0kB</td>
      <td class="uploadsuccess">上传成功</td>
    </tr>
    <tr>
      <td class="filename">A-Lin - 寂寞不痛.jpg</td>
      <td>244.1kB</td>
      <td class="uploadfail">上传失败</td>
    </tr>
    <tr>
      <td class="filename">陳綺貞 - 蜉蝣.jpg</td>
      <td>25.5kB</td>
      <td>正在上传</td>
    </tr>
  </tbody>
</table>
-->
</div>

<script type="text/javascript" src="file:///home/soda/.mozilla/firefox/3cudsl95.default/scriptish_scripts/cc98_reply_suite/1444331657.txt"></script>
<script type="text/javascript">
$(function() {
  // simple jquery draggable div plug-in
  // from https://reader-download.googlecode.com/svn/trunk/jquery-draggable/index.html
  // modified by soda<sodazju@gmail.com>
  $.fn.drags = function(opt) {

    opt = $.extend({
      draggable: "",
      selected: "",
      cursor: "move",
      draggableClass: "draggable",
      preventDefault: true
    }, opt);

    var $draggable = (opt.draggable === "") ? this : $(document).find(opt.draggable); // the one to be dragged
    var $selected = (opt.selected === "") ? this : $(document).find(opt.selected); // the one to be selected

    $draggable.addClass(opt.draggableClass);
    $selected.css('cursor', opt.cursor);

    $selected.on("mousedown", function(e) {
      var pos_y = $draggable.offset().top - e.pageY;
      var pos_x = $draggable.offset().left - e.pageX;

      $(document).on("mousemove", function(e) {
        $draggable.offset({
          top: e.pageY + pos_y,
          left: e.pageX + pos_x
        });
      }).on("mouseup", function() {
        $(this).off("mousemove"); // Unbind events from document
      });
      if (opt.preventDefault) {
        e.preventDefault(); // disable selection
      }
    });

    return this;
  }

  function showExpressionList() {
    if ($('#expression_list').length) return; // 如果页面中已经存在「心情列表」则返回

    $('#subject_line').append('<div id="expression_list"></div>');

    var expressionList = $('#expression_list');
    expressionList.css({
      "position": "fixed",
      "background-color": "#fff",
      "z-index": 100,
      "margin-top": "-25px",
      "margin-left": "-1px"
    });

    for (var i = 1; i <= 22; ++i) {
      var img = $('<img src="http://www.cc98.org/face/face' + i + '.gif">');
      img.css({
        "cursor": "pointer",
        "margin": "0 10px 0 0",
        "border": "0"
      });

      img.click(function() {
        $('#post_expression').children().eq(0).attr('src', this.src);
        $('#expression_list').remove();
      });

      expressionList.append(img);
    }
  }

  function addUBBCode(key) {
    var elem = document.getElementById('replycontent');
    var start = elem.selectionStart;
    var end = elem.selectionEnd;
    var open_tag = '[' + key + ']';
    var close_tag = '[/' + key + ']';
    var sel_txt = elem.value.substring(start,end);
    var replace = open_tag + sel_txt + close_tag;

    elem.value = elem.value.substring(0,start) + replace + elem.value.substring(end);

    elem.focus();
    elem.selectionStart = elem.selectionEnd = start + open_tag.length + sel_txt.length;
  }

  function showEmotions(){}

  var upload_panel_html =
'<div id="upload_panel">' +
  '<h3 id="upload_title" class="box_title">' +
    '添加附件' +
    '<span><a id="upload_close_btn" class="close_btn" title="关闭"></a></span>' +
  '</h3>' +
  '<input type="file" id="files" name="files[]" multiple>' +
  '<br>' +
  '<table class="btn_bar" width="100%">' +
    '<tbody>' +
      '<tr>' +
        '<td><input type="checkbox" id="image_autoshow" name="image_autoshow" value="autoshow"><label for="image_autoshow">直接显示图片</label></td>' +
        '<td><input type="button" id="confirm_upload" name="confirm_upload" class="soda_button" value="上传"></td>' +
      '</tr>' +
    '</tbody>' +
  '</table>' +
'</div>';

  $('#replybox_title').drags({"draggable": "#replydialog"});
  $('#dialog_close_btn').click(function() { $('#replydialog').remove(); });

  $('#post_expression').click(showExpressionList);

  $('#bold').click(function() { addUBBCode('b') });
  $('#strikethrough').click(function() { addUBBCode('del') });

  $('#add_attachments').click(function() {
    if ($('#upload_panel').length) return;

    $('body').append(upload_panel_html);  // 这样每次都会新建一个div而不是重复使用之前的那个
    $('#upload_title').drags({"draggable": "#upload_panel"});
    $('#upload_close_btn').click(function() { $('#upload_panel').remove(); })
    var upload_panel = $('#upload_panel');
    upload_panel.css({
      "top": ($(window).height() - upload_panel.height()) / 2 + $(document).scrollTop(),
      "left": ($(window).width() - upload_panel.width()) / 2 + $(document).scrollLeft()
    })
  });

  $('#replycontent').click(function() { $('#expression_list').remove(); });

})
</script>

</body>
</html>